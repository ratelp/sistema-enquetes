<%= form_with(model: poll, data: { controller: "poll-form" }) do |form| %>
  <% if poll.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(poll.errors.count, "error") %> prohibited this poll from being saved:</h2>

      <ul>
        <% poll.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :question, style: "display: block" %>
    <%= form.text_field :question %>
  </div>

  <div>
    <%= form.label :poll_type, style: "display: block" %>
    <%= form.select :poll_type,
                    Poll.poll_types.keys.map { |pt| [pt.humanize.titleize, pt] },
                    { prompt: "Selecione o tipo da enquete" },
                    { data: { action: "change->poll-form#toggleMaxChoices", poll_form_target: "pollTypeSelect" } } %>
  </div>

  <div>
    <%= form.label :expires_at, style: "display: block" %>
    <%= form.datetime_field :expires_at %>
  </div>

  <div data-poll-form-target="maxChoicesField" <%= 'hidden' unless poll.multipla_escolha? %>>
    <%= form.label :max_choices, style: "display: block" %>
    <%= form.number_field :max_choices %>
  </div>

  <fieldset>
    <legend>Opções da Enquete</legend>

    <template data-poll-form-target="optionTemplate">
      <%= form.fields_for :poll_options, PollOption.new, child_index: 'NEW_RECORD' do |option_form| %>
        <%= render "poll_option_fields", form: option_form %>
      <% end %>
    </template>

    <div data-poll-form-target="optionsWrapper">
      <%= form.fields_for :poll_options do |option_form| %>
        <%= render "poll_option_fields", form: option_form %>
      <% end %>
    </div>

    <button type="button" data-action="click->poll-form#addOption">Adicionar Opção</button>
  </fieldset>

  <div>
    <%= form.submit %>
  </div>
<% end %>
