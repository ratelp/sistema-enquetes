<div class="content-container" data-controller="toggle">
  <div class="poll-show-card">
    <div class="poll-show-header"></div>
    <div class="poll-show-content">
      <h1 class="poll-show-question"><%= @poll.question %></h1>
      <p class="poll-show-meta">
        <% if @poll.user %>
          <span><%= t('polls.poll.user') %>: <%= @poll.user.email %></span>
        <% elsif @poll.author_email %>
          <span><%= t('polls.poll.user') %>: <%= @poll.author_email %> </span>
        <% end %>
        <% if @poll.expires_at and !@poll.closed? %>
          <span>&middot; <%= t('polls.poll.expires_at') %>: <%= l(@poll.expires_at, format: :long) rescue @poll.expires_at %></span>
        <% end %>
      </p>

      <% can_vote = @poll.can_be_voted_on_by?(current_user) %>

      
      <% unless can_vote %>
        <% if @poll.closed? %>
          <div class="poll-status-message"><strong><%= t('.closed_message') %></strong></div>
        <% elsif user_signed_in? && @poll.voted_by?(current_user) %>
          <div class="poll-status-message"><strong><%= t('.voted_message') %></strong></div>
        <% elsif @poll.user == current_user %>
          <div class="poll-status-message"><strong><%= t('.own_poll') %></strong></div>
        <% end %>
        <br>
      <% end %>

     
        <%= form_with(model: [@poll, Vote.new], url: poll_votes_path(@poll)) do |form| %>
          <div class="poll-options-list">
            <% if @poll.unica_escolha? %>
              <% @poll.poll_options.each do |option| %>
                <label class="poll-option <%= 'disabled' unless can_vote %>">
                  <%= form.radio_button :poll_option_id, option.id, class: 'form-check-input', disabled: !can_vote %>
                  <span class="poll-option-text"><%= option.text %></span>
                </label>
              <% end %>
            <% elsif @poll.multipla_escolha? %>
              <% if !@poll.closed? && !@poll.voted_by?(current_user) && !(@poll.user == current_user) %>
              <p class="poll-options-helper"><%= t('.select_up_to', count: @poll.max_choices) %></p>
              <% end %>
              <% @poll.poll_options.each do |option| %>
                <label class="poll-option <%= 'disabled' unless can_vote %>">
                  <%= check_box_tag "vote[poll_option_ids][]", option.id, false, id: "vote_poll_option_ids_#{option.id}", class: 'form-check-input', disabled: !can_vote %>
                  <span class="poll-option-text"><%= option.text %></span>
                </label>
              <% end %>
            <% end %>
          </div>
          <% if can_vote %>
            <div class="actions">
              <%= form.submit t('.submit_vote'), class: 'btn-primary' %>
            </div>
          <% end %>
        <% end %>

      <div data-toggle-target="content" class="hidden">
        <%= render @poll, details: true %>
      </div>
    </div>
  </div>
  <div class="poll-show-actions">
    <div class="left-actions">
      <%= link_to t('.back'), polls_path, class: 'btn-secondary' %>
      <% if current_user == @poll.user && @poll.open? %>
        <%= link_to t('.edit_poll'), edit_poll_path(@poll), class: 'btn-secondary' %>
        <%= button_to t('.close_poll'), close_poll_path(@poll), method: :patch, class: 'btn-secondary' %>
      <% end %>
    </div>
    <div class="right-actions">
      <%= button_tag t('.show_results'), type: "button", class: "btn-primary", data: { action: "click->toggle#toggle", toggle_target: "button", toggle_text_value: t('.hide_results') } %>
      <% if current_user == @poll.user %>
        <%= button_to t('.delete_poll'), @poll, method: :delete, form: { data: { turbo_confirm: t('helpers.confirm') } }, class: 'btn-danger-link' %>
      <% end %>
    </div>
  </div>
</div>
